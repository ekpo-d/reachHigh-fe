<!DOCTYPE html><html class="dark no-js"><head><meta charset="utf-8"><meta content="ie=edge" http-equiv="x-ua-compatible"><meta content="width=device-width,initial-scale=1" name="viewport"><base data-ice="baseUrl" href="../../../"><title data-ice="title">src/stores/AuthStore.js | reachhigh</title><script src="script/search_index.js"></script><link href="css/2f0514c18c642778d627.css" rel="stylesheet"></head><body class="layout-container" data-ice="rootContainer"><header class="js_mainHeader main-header"><div class="menu-switch"><a href="#" class="switch js_menuSwitch menu-switch"><span class="icon menu-icon"><svg viewbox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/></svg></span></a></div><nav class="main-nav"><a href="./" class="link link-to-home"><span class="icon link-icon home-icon"><svg viewbox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/></svg> </span><span class="link-text">Home</span> </a><a href="identifiers.html" class="link link-to-reference"><span class="icon link-icon reference-icon"><svg viewbox="0 0 24 24"><path d="M16,6H13V7.9H16C18.26,7.9 20.1,9.73 20.1,12A4.1,4.1 0 0,1 16,16.1H13V18H16A6,6 0 0,0 22,12C22,8.68 19.31,6 16,6M3.9,12C3.9,9.73 5.74,7.9 8,7.9H11V6H8A6,6 0 0,0 2,12A6,6 0 0,0 8,18H11V16.1H8C5.74,16.1 3.9,14.26 3.9,12M8,13H16V11H8V13Z"/></svg> </span><span class="link-text">Reference</span> </a><a href="source.html" class="link link-to-source"><span class="icon link-icon source-icon"><svg viewbox="0 0 24 24"><path d="M8,3A2,2 0 0,0 6,5V9A2,2 0 0,1 4,11H3V13H4A2,2 0 0,1 6,15V19A2,2 0 0,0 8,21H10V19H8V14A2,2 0 0,0 6,12A2,2 0 0,0 8,10V5H10V3M16,3A2,2 0 0,1 18,5V9A2,2 0 0,0 20,11H21V13H20A2,2 0 0,0 18,15V19A2,2 0 0,1 16,21H14V19H16V14A2,2 0 0,1 18,12A2,2 0 0,1 16,10V5H14V3H16Z"/></svg> </span><span class="link-text">Source</span> </a></nav><div class="js_searchBox search-box"><div class="js_searchInputWrapper search-input-wrapper"><span class="icon js_searchIcon search-icon"><svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </span><input class="js_searchInput search-input"></div><ul class="hidden js_searchResult search-result"></ul></div><div class="mode-switch"><a href="#" class="switch js_modeSwitch mode-switch"><span class="icon light-dark-icon"><svg viewbox="0 0 24 24"><path d="M7.5,2C5.71,3.15 4.5,5.18 4.5,7.5C4.5,9.82 5.71,11.85 7.53,13C4.46,13 2,10.54 2,7.5A5.5,5.5 0 0,1 7.5,2M19.07,3.5L20.5,4.93L4.93,20.5L3.5,19.07L19.07,3.5M12.89,5.93L11.41,5L9.97,6L10.39,4.3L9,3.24L10.75,3.12L11.33,1.47L12,3.1L13.73,3.13L12.38,4.26L12.89,5.93M9.59,9.54L8.43,8.81L7.31,9.59L7.65,8.27L6.56,7.44L7.92,7.35L8.37,6.06L8.88,7.33L10.24,7.36L9.19,8.23L9.59,9.54M19,13.5A5.5,5.5 0 0,1 13.5,19C12.28,19 11.15,18.6 10.24,17.93L17.93,10.24C18.6,11.15 19,12.28 19,13.5M14.6,20.08L17.37,18.93L17.13,22.28L14.6,20.08M18.93,17.38L20.08,14.61L22.28,17.15L18.93,17.38M20.08,12.42L18.94,9.64L22.28,9.88L20.08,12.42M9.63,18.93L12.4,20.08L9.87,22.27L9.63,18.93Z"/></svg></span></a></div><div class="settings-switch"><a href="#" class="switch js_settingsSwitch settings-switch"><span class="icon settings-icon"><svg viewbox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/></svg></span></a></div></header><main class="main"><div class="content" data-ice="content"><h1 data-ice="title">src/stores/AuthStore.js</h1><pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* eslint-disable arrow-body-style */
import {
  observable,
  action,
  runInAction,
  toJS,
} from &apos;mobx&apos;;
import cookie from &apos;js-cookie&apos;;

import { setClassProps, postData } from &apos;../utils/helpers&apos;;
import { signin } from &apos;../utils/auth&apos;;

/**
 * MobX store class.
 * For app wide authentication/authorization.
 * @class
 */
export default class AuthStore {
	constructor(uiStore) {
		this.uiStore = uiStore;
	}

	@observable
  loginLoading = false;

	@observable
	signupLoading = false;

	@observable
	loginCredentials = {
    email: &apos;&apos;,
    password: &apos;&apos;,
    strategy: &apos;local&apos;,
	};

	@observable
	loginErrors = {
    visible: false,
    message: &apos;&apos;,
  };

	@observable
	signupData = {
    name: &apos;&apos;,
    email: &apos;&apos;,
    password: &apos;&apos;,
    confirmPassword: &apos;&apos;,
    TOS: false,
	};

	@observable
	signupErrors = {
    visible: false,
    type: &apos;&apos;,
    message: &apos;&apos;,
  };

	/**
   * Function used to validate that all fields are filled
	 */
  validatefields = () =&gt; {
    return !!this.signupData.name
      &amp;&amp; !!this.signupData.email
      &amp;&amp; !!this.signupData.password
      &amp;&amp; !!this.signupData.confirmPassword
      &amp;&amp; !!this.signupData.TOS;
  }

	/**
   * Function used to validate that the password
   * and re-type password fields match
	 */
  validatePasswordMatch = () =&gt; {
    return !!this.signupData.password
    &amp;&amp; !!this.signupData.confirmPassword
    &amp;&amp; this.signupData.password === this.signupData.confirmPassword;
  }

	/**
   * Function used to validate an email address
	 */
	@action
  validateEmail = () =&gt; {
    if (this.signupData.email.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)) {
      this.signupErrors = {
        visible: false,
        type: &apos;&apos;,
        message: &apos;&apos;,
      };
    }
    else {
      this.signupErrors = {
        visible: true,
        type: &apos;email&apos;,
        message: &apos;Invalid email address.&apos;,
      };
    }
  }

	/**
   * Function used to validate the password entered
   * is equal or more than 6 characters
	 */
	@action
  validatePassword = () =&gt; {
    if (this.signupData.password.length &gt;= 6) {
      this.signupErrors = {
        visible: false,
        type: &apos;&apos;,
        message: &apos;&apos;,
      };
    }
    else {
      this.signupErrors = {
        visible: true,
        type: &apos;password&apos;,
        message: &apos;Password should be equal or longer than 6 characters.&apos;,
      };
    }
  }

	/**
   * Login Function,
   * It take&apos;s the input credentials
   * and makes and authentication request.
   * Saves the token and user id, then navigates to the goals page.
   * Also, handles the display of login input errors.
	 * @param {object} e - DOM event.
	 */
	@action
	login = async (e = null) =&gt; {
    if (e) e.preventDefault();
    this.loginLoading = true;
    if (this.loginCredentials.email &amp;&amp; this.loginCredentials.password) {
      await postData(&apos;authentication&apos;, this.loginCredentials)
      .then(async response =&gt; {
        runInAction(() =&gt; {
          this.loginCredentials.email = &apos;&apos;;
          this.loginCredentials.password = &apos;&apos;;
          this.loginErrors.visible = false;
          this.loginErrors.message = &apos;&apos;;
          this.loginLoading = false;
        });

        const { accessToken, user: { _id } } = response.data;
        cookie.set(&apos;u_id&apos;, _id, { expires: 1 });
        await signin({ token: accessToken });
      })
      .catch(error =&gt; {
        if (error.response.status === 401) {
          runInAction(() =&gt; {
            this.loginErrors.visible = true;
            this.loginErrors.message = &apos;Invalid credentials, email or password incorrect.&apos;;
            this.loginLoading = false;
          });
        }
        else {
          this.uiStore.setClassProps([
            {
              name: &apos;open&apos;,
              value: true,
            },
            {
              name: &apos;type&apos;,
              value: &apos;error&apos;,
            },
          ], this.uiStore.modal);
        }
      });
    }
    else {
      this.loginErrors.visible = true;
      this.loginErrors.message = &apos;Email and Password fields needed&apos;;
    }
	}

	/**
   * Signup Function,
   * It take&apos;s the input credentials
   * and request to create a new user.
   * On creation of user, it makes a authentication request
   * and follows the login flow
   * Also, handles the display of signup input errors.
	 * @param {object} e - DOM event.
	 */
	@action
	signup = async (e = null) =&gt; {
    if (e) e.preventDefault();
    this.signupLoading = true;
    if (this.validatefields() &amp;&amp; this.validatePasswordMatch()) {
      const signupData = Object.assign({}, toJS(this.signupData));
      delete signupData.confirmPassword;
      delete signupData.TOS;

      await postData(&apos;users&apos;, this.signupData)
      .then(async response =&gt; {
        runInAction(() =&gt; {
          this.signupErrors = {
            visible: false,
            type: &apos;&apos;,
            message: &apos;&apos;,
          };
        });

        return postData(&apos;authentication&apos;, {
          email: response.data.email,
          password: this.signupData.password,
          strategy: &apos;local&apos;,
        });
      })
      .then(async response =&gt; {
        runInAction(() =&gt; {
          this.signupData = {
            name: &apos;&apos;,
            email: &apos;&apos;,
            password: &apos;&apos;,
            confirmPassword: &apos;&apos;,
            TOS: false,
          };
          this.signupLoading = false;
        });
        const { accessToken, user: { _id } } = response.data;
        cookie.set(&apos;u_id&apos;, _id, { expires: 1 });
        await signin({ token: accessToken });
      })
      .catch(error =&gt; {
        if (error.response.status === 409) {
          runInAction(() =&gt; {
            this.signupErrors = {
              visible: true,
              type: &apos;conflict&apos;,
              message: &apos;Email has already been used&apos;,
            };
            this.signupLoading = false;
          });
        }
        else {
          this.uiStore.setClassProps([
            {
              name: &apos;open&apos;,
              value: true,
            },
            {
              name: &apos;type&apos;,
              value: &apos;error&apos;,
            },
          ], this.uiStore.modal);
        }
      });
    }
    else {
      this.signupErrors = {
        visible: true,
        type: &apos;form&apos;,
        message: &apos;All fields below should be filled out, and passwords must match.&apos;,
      };
    }
	}

	/**
	 * Function used to assign values to the members of
	 *  this class from an external function or a react component.
	 * @param {Array} arr - An array key:value pairs of class members and their values
	 * @param {Object} self - Refers to the class itself or a member.
	 */
	@action
	setClassProps = (arr, self = this) =&gt; setClassProps(arr, self);
}
</code></pre></div><footer class="main-footer"><img alt="esdoc logo" class="esdoc-logo" src="image/esdoc-logo-mini.png"> <span>Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span></a></span></footer></main><aside class="sidebar initial js_sidebarLeft sidebar-left" data-ice="nav"><nav class="nav"><ul class="nav-list"><li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#components-auth">components/auth</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/components/auth/SignIn.js~SignIn.html">SignIn</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/components/auth/SignUp.js~SignUp.html">SignUp</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#components-goals">components/goals</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/components/goals/Goals.js~Goals.html">Goals</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#components-home">components/home</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-Home">Home</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#components-navigation">components/navigation</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-HorizontalNavigation">HorizontalNavigation</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#components-tasks">components/tasks</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/components/tasks/TaskView.js~TaskView.html">TaskView</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/components/tasks/Tasks.js~Tasks.html">Tasks</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#stores">stores</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/stores/AuthStore.js~AuthStore.html">AuthStore</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/stores/GoalsStore.js~GoalsStore.html">GoalsStore</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-class" data-ice="kind">C</span> <span class="name _" data-ice="name"><span><a href="class/src/stores/UIStore.js~UIStore.html">UIStore</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><a class="nav-link js_dirPath _" data-ice="dirPath" href="identifiers.html#utils">utils</a><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-auth">auth</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-logout">logout</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-signin">signin</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-withAuthSync">withAuthSync</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-getData">getData</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-getInitialProps">getInitialProps</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-patchData">patchData</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-postData">postData</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-renderIf">renderIf</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-runInActionUtil">runInActionUtil</a></span></span></div></li>
<li class="nav-item js_navItem _" data-ice="doc"><div class="hidden fake-nav-link js_fakeLink _"><span class="kind _kind-function" data-ice="kind">F</span> <span class="name _" data-ice="name"><span><a href="function/index.html#static-function-setClassProps">setClassProps</a></span></span></div></li>
</ul></nav></aside><aside class="sidebar closed js_sidebarRight sidebar-right"><nav class="nav fonts-nav"><ul class="nav-list js_fontOptions"><li class="nav-item"><span class="headline nav-link">Main fonts</span></li></ul></nav><nav class="nav colorschemes-nav"><ul class="nav-list js_colorschemeOptions"><li class="nav-item"><span class="headline nav-link">Syntax themes</span></li></ul></nav></aside><script src="script/2f0514c18c642778d627.js"></script></body></html>